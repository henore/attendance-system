#!/bin/bash
# scripts/secure-database.sh
# уГЗуГ╝уВ┐уГЩуГ╝уВ╣уГХуВбуВдуГлуБоуВ╗уВнуГеуГкуГЖуВгшинхоЪуВ╣уВпуГкуГЧуГИ

echo "ЁЯФТ уГЗуГ╝уВ┐уГЩуГ╝уВ╣уВ╗уВнуГеуГкуГЖуВгшинхоЪуВТщЦЛхзЛ..."

# уГЗуГ╝уВ┐уГЩуГ╝уВ╣уГЗуВгуГмуВпуГИуГкуБоф╜ЬцИРя╝ИхнШхЬиуБЧуБкуБДха┤хРИя╝Й
if [ ! -d "database" ]; then
    mkdir -p database
    echo "тЬЕ уГЗуГ╝уВ┐уГЩуГ╝уВ╣уГЗуВгуГмуВпуГИуГкуВТф╜ЬцИРуБЧуБ╛уБЧуБЯ"
fi

# уГЗуВгуГмуВпуГИуГкцийщЩРуБошинхоЪя╝ИуВкуГ╝уГКуГ╝уБоуБ┐уВвуВпуВ╗уВ╣хПпшГ╜я╝Й
chmod 700 database/
echo "тЬЕ уГЗуГ╝уВ┐уГЩуГ╝уВ╣уГЗуВгуГмуВпуГИуГкуБоцийщЩРуВТ700уБлшинхоЪуБЧуБ╛уБЧуБЯ"

# уГЗуГ╝уВ┐уГЩуГ╝уВ╣уГХуВбуВдуГлуБоцийщЩРшинхоЪя╝ИуВкуГ╝уГКуГ╝уБоуБ┐шкнуБ┐цЫ╕уБНхПпшГ╜я╝Й
if [ -f "database/attendance.db" ]; then
    chmod 600 database/attendance.db
    echo "тЬЕ attendance.dbуБоцийщЩРуВТ600уБлшинхоЪуБЧуБ╛уБЧуБЯ"
fi

if [ -f "database/sessions.db" ]; then
    chmod 600 database/sessions.db
    echo "тЬЕ sessions.dbуБоцийщЩРуВТ600уБлшинхоЪуБЧуБ╛уБЧуБЯ"
fi

# шкНши╝цГЕха▒уГХуВбуВдуГлуБоцийщЩРшинхоЪя╝ИхнШхЬиуБЩуВЛха┤хРИя╝Й
if [ -f "database/initial-credentials.txt" ]; then
    chmod 600 database/initial-credentials.txt
    echo "тЬЕ initial-credentials.txtуБоцийщЩРуВТ600уБлшинхоЪуБЧуБ╛уБЧуБЯ"
fi

# чП╛хЬиуБоцийщЩРуВТчв║шкН
echo ""
echo "ЁЯУЛ чП╛хЬиуБоуГХуВбуВдуГлцийщЩР:"
ls -la database/

echo ""
echo "ЁЯФР уВ╗уВнуГеуГкуГЖуВгшинхоЪхоМф║Ж!"
echo "тЪая╕П  цЬмчХкчТ░хвГуБзуБпф╗еф╕ЛуБош┐╜хКауВ╗уВнуГеуГкуГЖуВгхп╛чнЦуВТцОихеи:"
echo "   - уГХуВбуВдуВвуВжуВйуГ╝уГлуБошинхоЪ"
echo "   - хоЪцЬЯчЪДуБкуГРуГГуВпуВвуГГуГЧ"
echo "   - уГнуВ░чЫгшжЦуБошинхоЪ"
echo "   - SSL/TLSши╝цШОцЫ╕уБошинхоЪ"